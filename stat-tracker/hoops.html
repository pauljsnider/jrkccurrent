<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildcats Hoops Stat Tracker</title>
    <link rel="icon" href="../Images/logo.png" type="image/png">
    <style>
        /* K-State Wildcats Color Variables */
        :root {
            --kstate-purple: #512888;   /* Primary purple */
            --kstate-dark-purple: #3d1f66; /* Darker purple for depth */
            --kstate-silver: #c0c0c0;   /* Silver accent */
            --white: #ffffff;           /* White */
            --black: #000000;           /* Black */
            --light-gray: #f4f4f4;      /* Light background */
            --medium-gray: #999999;     /* Medium gray */
            --dark-gray: #333333;       /* Dark gray text */
            --gold: #ffc627;            /* Gold accent */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', 'Roboto', sans-serif;
            background: var(--light-gray);
            padding: 5px;
            font-size: 14px;
            color: var(--dark-gray);
        }

        .header {
            background: var(--kstate-purple);
            color: var(--white);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(81, 40, 136, 0.3);
        }

        .game-info {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .game-info input, .game-info select {
            padding: 6px 8px;
            border-radius: 4px;
            border: 1px solid var(--medium-gray);
            font-size: 12px;
            background: var(--white);
        }

        .scoreboard {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .score-display {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--kstate-silver);
        }

        .score-value {
            background: var(--white);
            color: var(--kstate-purple);
            padding: 5px 15px;
            border-radius: 4px;
            min-width: 50px;
            text-align: center;
            border: 2px solid var(--white);
            font-weight: bold;
        }

        .timer {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .period-controls {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .period-btn {
            padding: 6px 10px;
            border: 2px solid var(--white);
            background: rgba(255, 255, 255, 0.2);
            color: var(--white);
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            min-height: 32px;
            font-weight: 500;
        }

        .period-btn.active {
            background: var(--white);
            color: var(--kstate-purple);
            border-color: var(--white);
        }

        .timer-controls {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            min-height: 36px;
        }

        .btn-start { background: var(--white); color: var(--kstate-purple); font-weight: 600; }
        .btn-stop { background: #dc2626; color: var(--white); }
        .btn-reset { background: var(--dark-gray); color: var(--white); }
        .btn-email { background: var(--kstate-dark-purple); color: var(--white); }
        .btn-secondary { background: var(--kstate-dark-purple); color: var(--white); }
        .btn-small { padding: 6px 10px; font-size: 11px; min-height: 28px; }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-container {
            background: var(--white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 2px solid var(--kstate-purple);
            margin-bottom: 10px;
        }

        .stats-header {
            background: var(--kstate-purple);
            padding: 15px;
            border-bottom: 2px solid var(--kstate-dark-purple);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--white);
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        .stats-table th {
            background: var(--light-gray);
            padding: 2px 0px;
            text-align: center;
            font-weight: 600;
            font-size: 10px;
            border-bottom: 2px solid var(--kstate-purple);
            line-height: 1.1;
            color: var(--kstate-purple);
        }

        .stats-table td {
            padding: 2px 0px;
            text-align: center;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .player-name {
            text-align: left !important;
            font-weight: 500;
            width: 62px;
            font-size: 9px;
            padding-left: 2px !important;
            padding-right: 2px !important;
            line-height: 1.1;
            word-break: break-word;
        }

        .stat-cell {
            width: 52px;
        }

        .stat-cell-pts {
            width: 84px;
        }

        .stat-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
        }

        .stat-display {
            font-weight: bold;
            font-size: 13px;
            min-height: 14px;
            color: var(--kstate-purple);
        }

        .stat-buttons {
            display: flex;
            gap: 1px;
        }

        .stat-btn {
            width: 20px;
            height: 20px;
            border: 1px solid var(--kstate-purple);
            background: var(--white);
            border-radius: 2px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .stat-btn:hover {
            background: var(--light-gray);
        }

        .stat-btn.decrement {
            background: #fef2f2;
            color: #dc2626;
        }

        .stat-btn.increment {
            background: #f4f0ff;
            color: var(--kstate-purple);
        }

        .stat-btn:hover {
            border-color: var(--kstate-dark-purple);
        }

        .stat-btn.has-stats {
            background: var(--kstate-purple);
            border-color: var(--kstate-purple);
            color: var(--white);
            font-weight: bold;
        }

        .notes-cell {
            min-width: 120px;
        }

        .notes-input {
            flex: 1;
            padding: 2px;
            border: 1px solid #d1d5db;
            border-radius: 2px;
            font-size: 9px;
            min-width: 0;
        }

        .notes-btn {
            width: 26px;
            height: 20px;
            padding: 1px;
            border: 1px solid var(--kstate-purple);
            background: var(--kstate-purple);
            color: var(--white);
            border-radius: 2px;
            font-size: 8px;
            cursor: pointer;
            margin-left: 2px;
            flex-shrink: 0;
        }

        .notes-btn:hover {
            background: var(--kstate-dark-purple);
        }

        .notes-container {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .game-log {
            margin-top: 15px;
            background: var(--white);
            border-radius: 6px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid var(--kstate-purple);
        }

        .game-log h3 {
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--kstate-purple);
            font-weight: bold;
        }

        .log-entry {
            padding: 4px 8px;
            margin: 2px 0;
            background: var(--light-gray);
            border-radius: 3px;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            border-left: 3px solid var(--kstate-purple);
        }

        .log-time {
            color: var(--kstate-dark-purple);
            font-weight: 500;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="game-info">
            <input type="text" id="opponentName" placeholder="Opponent name..." style="width: 150px;">
            <input type="date" id="gameDate" style="width: 140px;">
        </div>

        <div class="scoreboard">
            <div class="score-display">
                <span class="score-label">Wildcats</span>
                <div class="score-value" id="homeScore">0</div>
            </div>
            <span>-</span>
            <div class="score-display">
                <span class="score-label">Opponent</span>
                <div class="score-value" id="awayScore">0</div>
            </div>
        </div>

        <div class="period-controls">
            <button class="period-btn active" data-period="Q1" onclick="setPeriod('Q1')">Q1</button>
            <button class="period-btn" data-period="Q2" onclick="setPeriod('Q2')">Q2</button>
            <button class="period-btn" data-period="Q3" onclick="setPeriod('Q3')">Q3</button>
            <button class="period-btn" data-period="Q4" onclick="setPeriod('Q4')">Q4</button>
            <button class="period-btn" data-period="OT" onclick="setPeriod('OT')">OT</button>
        </div>

        <div class="timer" id="timer">00:00</div>
        <div class="timer-controls">
            <button class="btn btn-start" id="startBtn">Start</button>
            <button class="btn btn-stop" id="stopBtn" disabled>Stop</button>
            <button class="btn btn-reset" id="resetBtn">Reset</button>
            <button class="btn btn-email" id="emailBtn">Email Summary</button>
        </div>
    </div>

    <div class="stats-container">
        <div class="stats-header">
            <div class="stats-title">Wildcats Player Stats</div>
        </div>

        <table class="stats-table">
            <thead>
                <tr>
                    <th style="width: 62px;">Player</th>
                    <th class="stat-cell-pts">üèÄ<br>PTS</th>
                    <th class="stat-cell">üìä<br>REB</th>
                    <th class="stat-cell">ü§ù<br>AST</th>
                    <th class="stat-cell">üéØ<br>STL</th>
                    <th class="stat-cell">‚ö†Ô∏è<br>TO</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody id="statsTable">
                <!-- Player rows will be generated here -->
            </tbody>
        </table>
    </div>

    <div class="stats-container">
        <div class="stats-header">
            <div class="stats-title">Opponent Team Stats</div>
            <button class="btn btn-secondary btn-small" id="addOpponentBtn">Add Player</button>
        </div>

        <table class="stats-table">
            <thead>
                <tr>
                    <th style="width: 62px;">Player</th>
                    <th class="stat-cell-pts">üèÄ<br>PTS</th>
                    <th class="stat-cell">üìä<br>REB</th>
                    <th class="stat-cell">ü§ù<br>AST</th>
                    <th class="stat-cell">üéØ<br>STL</th>
                    <th class="stat-cell">‚ö†Ô∏è<br>TO</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody id="opponentStatsTable">
                <!-- Opponent rows will be generated here -->
            </tbody>
        </table>
    </div>

    <div class="game-log">
        <h3>Game Log</h3>
        <div id="gameLog">
            <div class="log-entry">
                <span>Game log will appear here as you track stats</span>
                <span class="log-time">--:--</span>
            </div>
        </div>
    </div>

    <script>
        // Static roster data (ordered by jersey number)
        const ROSTER = [
            { id: 6, name: 'Madison', jersey: '00' },
            { id: 1, name: 'Winnie', jersey: 1 },
            { id: 2, name: 'Felicity', jersey: 2 },
            { id: 3, name: 'Hazel', jersey: 3 },
            { id: 4, name: 'Kayla', jersey: 4 },
            { id: 5, name: 'Blake', jersey: 5 },
            { id: 7, name: 'Emma', jersey: 10 },
            { id: 8, name: 'Teagan', jersey: 15 },
            { id: 9, name: 'Samantha', jersey: 22 },
            { id: 10, name: 'Emersyn', jersey: 25 }
        ];

        // Game state
        let gameState = {
            opponent: '',
            date: '',
            period: 'Q1',
            startTime: null,
            elapsed: 0,
            isRunning: false,
            homeScore: 0,
            awayScore: 0,
            stats: {},
            opponentStats: {},
            gameLog: []
        };

        // Opponent team roster (starts with 3 default rows)
        let opponentRoster = [
            { id: 'opp1', name: '', isEditable: true },
            { id: 'opp2', name: '', isEditable: true },
            { id: 'opp3', name: '', isEditable: true }
        ];

        // Initialize stats for all players
        ROSTER.forEach(player => {
            gameState.stats[player.id] = {
                pts: 0,
                reb: 0,
                ast: 0,
                stl: 0,
                to: 0,
                notes: ''
            };
        });

        // Initialize opponent stats
        function initializeOpponentStats() {
            opponentRoster.forEach(player => {
                gameState.opponentStats[player.id] = {
                    pts: 0,
                    reb: 0,
                    ast: 0,
                    stl: 0,
                    to: 0,
                    notes: ''
                };
            });
        }

        initializeOpponentStats();

        // Load from localStorage
        function loadGameState() {
            const saved = localStorage.getItem('hoops-game-state');
            if (saved) {
                const loaded = JSON.parse(saved);
                gameState = { ...gameState, ...loaded };

                // Restore UI
                document.getElementById('opponentName').value = gameState.opponent || '';
                document.getElementById('gameDate').value = gameState.date || '';
                updateScoreboard();
                setPeriod(gameState.period);

                // If timer was running, adjust start time
                if (gameState.isRunning) {
                    gameState.startTime = Date.now() - gameState.elapsed;
                }
            }

            const savedOpponent = localStorage.getItem('hoops-opponent-roster');
            if (savedOpponent) {
                opponentRoster = JSON.parse(savedOpponent);
                initializeOpponentStats();
            }
        }

        // Save to localStorage
        function saveGameState() {
            localStorage.setItem('hoops-game-state', JSON.stringify(gameState));
            localStorage.setItem('hoops-opponent-roster', JSON.stringify(opponentRoster));
        }

        // Period selection
        function setPeriod(period) {
            gameState.period = period;
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.period === period);
            });
            saveGameState();
        }

        // Timer functions
        function startTimer() {
            if (!gameState.isRunning) {
                gameState.startTime = Date.now() - gameState.elapsed;
                gameState.isRunning = true;
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                addLogEntry('Game started');
                saveGameState();
            }
        }

        function stopTimer() {
            if (gameState.isRunning) {
                gameState.isRunning = false;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                addLogEntry('Game stopped');
                saveGameState();
            }
        }

        function resetTimer() {
            if (confirm('Reset timer and clear all stats?')) {
                gameState = {
                    opponent: '',
                    date: '',
                    period: 'Q1',
                    startTime: null,
                    elapsed: 0,
                    isRunning: false,
                    homeScore: 0,
                    awayScore: 0,
                    stats: {},
                    opponentStats: {},
                    gameLog: []
                };

                // Reset all stats
                ROSTER.forEach(player => {
                    gameState.stats[player.id] = {
                        pts: 0,
                        reb: 0,
                        ast: 0,
                        stl: 0,
                        to: 0,
                        notes: ''
                    };
                });

                initializeOpponentStats();

                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('opponentName').value = '';
                document.getElementById('gameDate').value = '';

                setPeriod('Q1');
                updateScoreboard();
                renderStats();
                renderOpponentStats();
                renderGameLog();
                updateTimer();
                saveGameState();
            }
        }

        function updateTimer() {
            if (gameState.isRunning) {
                gameState.elapsed = Date.now() - gameState.startTime;
            }

            const totalSeconds = Math.floor(gameState.elapsed / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;

            document.getElementById('timer').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function getGameTime() {
            const totalSeconds = Math.floor(gameState.elapsed / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${gameState.period} ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Scoreboard update
        function updateScoreboard() {
            document.getElementById('homeScore').textContent = gameState.homeScore;
            document.getElementById('awayScore').textContent = gameState.awayScore;
        }

        // Stat tracking functions
        function incrementStat(playerId, statType, amount = 1) {
            gameState.stats[playerId][statType] += amount;
            const player = ROSTER.find(p => p.id === playerId);

            // Update score if points
            if (statType === 'pts') {
                gameState.homeScore += amount;
                updateScoreboard();
                addLogEntry(`#${player.jersey} ${player.name} +${amount} PTS`);
            } else {
                addLogEntry(`#${player.jersey} ${player.name} - ${getStatLabel(statType)}`);
            }

            renderStats();
            saveGameState();
        }

        function decrementStat(playerId, statType) {
            if (gameState.stats[playerId][statType] > 0) {
                const amount = statType === 'pts' && gameState.stats[playerId][statType] >= 3 ?
                    (confirm('Remove 3 points?') ? 3 : confirm('Remove 2 points?') ? 2 : 1) : 1;

                gameState.stats[playerId][statType] -= amount;
                const player = ROSTER.find(p => p.id === playerId);

                // Update score if points
                if (statType === 'pts') {
                    gameState.homeScore -= amount;
                    updateScoreboard();
                }

                addLogEntry(`#${player.jersey} ${player.name} - ${getStatLabel(statType)} removed`);
                renderStats();
                saveGameState();
            }
        }

        function updateNotes(playerId, notes) {
            gameState.stats[playerId].notes = notes;
            saveGameState();
        }

        function logPlayerNote(playerId) {
            const player = ROSTER.find(p => p.id === playerId);
            const notes = gameState.stats[playerId].notes;
            if (notes.trim()) {
                addLogEntry(`#${player.jersey} ${player.name} - Note: ${notes}`);
            }
        }

        function getStatLabel(statType) {
            const labels = {
                pts: 'Points',
                reb: 'Rebound',
                ast: 'Assist',
                stl: 'Steal',
                to: 'Turnover'
            };
            return labels[statType] || statType;
        }

        function addLogEntry(text) {
            const entry = {
                text: text,
                time: getGameTime(),
                timestamp: Date.now()
            };
            gameState.gameLog.unshift(entry);
            renderGameLog();
            saveGameState();
        }

        // Rendering functions
        function renderStats() {
            const tbody = document.getElementById('statsTable');
            tbody.innerHTML = ROSTER.map(player => {
                const stats = gameState.stats[player.id];
                return `
                    <tr>
                        <td class="player-name">#${player.jersey} ${player.name}</td>
                        <td class="stat-cell-pts">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.pts || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementStat(${player.id}, 'pts')" ${stats.pts === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementStat(${player.id}, 'pts', 1)" title="+1">1</button>
                                    <button class="stat-btn increment" onclick="incrementStat(${player.id}, 'pts', 2)" title="+2">2</button>
                                    <button class="stat-btn increment" onclick="incrementStat(${player.id}, 'pts', 3)" title="+3">3</button>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.reb || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementStat(${player.id}, 'reb')" ${stats.reb === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementStat(${player.id}, 'reb')">+</button>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.ast || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementStat(${player.id}, 'ast')" ${stats.ast === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementStat(${player.id}, 'ast')">+</button>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.stl || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementStat(${player.id}, 'stl')" ${stats.stl === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementStat(${player.id}, 'stl')">+</button>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.to || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementStat(${player.id}, 'to')" ${stats.to === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementStat(${player.id}, 'to')">+</button>
                                </div>
                            </div>
                        </td>
                        <td class="notes-cell">
                            <div class="notes-container">
                                <input type="text" class="notes-input"
                                       value="${stats.notes}"
                                       onchange="updateNotes(${player.id}, this.value)"
                                       placeholder="Quick notes...">
                                <button class="notes-btn" onclick="logPlayerNote(${player.id})">Log</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderGameLog() {
            const logDiv = document.getElementById('gameLog');
            if (gameState.gameLog.length === 0) {
                logDiv.innerHTML = '<div class="log-entry"><span>Game log will appear here as you track stats</span><span class="log-time">--:--</span></div>';
                return;
            }

            logDiv.innerHTML = gameState.gameLog.map(entry => `
                <div class="log-entry">
                    <span>${entry.text}</span>
                    <span class="log-time">${entry.time}</span>
                </div>
            `).join('');
        }

        // Opponent team functions
        function addOpponentRow() {
            const newId = 'opp' + Date.now();
            const newPlayer = { id: newId, name: '', isEditable: true };
            opponentRoster.push(newPlayer);

            gameState.opponentStats[newId] = {
                pts: 0,
                reb: 0,
                ast: 0,
                stl: 0,
                to: 0,
                notes: ''
            };

            renderOpponentStats();
            saveGameState();
        }

        function updateOpponentName(playerId, name) {
            const player = opponentRoster.find(p => p.id === playerId);
            if (player) {
                player.name = name;
                saveGameState();
            }
        }

        function incrementOpponentStat(playerId, statType, amount = 1) {
            gameState.opponentStats[playerId][statType] += amount;
            const player = opponentRoster.find(p => p.id === playerId);
            const playerName = player.name || 'Opponent Player';

            // Update score if points
            if (statType === 'pts') {
                gameState.awayScore += amount;
                updateScoreboard();
                addLogEntry(`${playerName} (Opp) +${amount} PTS`);
            } else {
                addLogEntry(`${playerName} (Opp) - ${getStatLabel(statType)}`);
            }

            renderOpponentStats();
            saveGameState();
        }

        function decrementOpponentStat(playerId, statType) {
            if (gameState.opponentStats[playerId][statType] > 0) {
                const amount = statType === 'pts' && gameState.opponentStats[playerId][statType] >= 3 ?
                    (confirm('Remove 3 points?') ? 3 : confirm('Remove 2 points?') ? 2 : 1) : 1;

                gameState.opponentStats[playerId][statType] -= amount;
                const player = opponentRoster.find(p => p.id === playerId);
                const playerName = player.name || 'Opponent Player';

                // Update score if points
                if (statType === 'pts') {
                    gameState.awayScore -= amount;
                    updateScoreboard();
                }

                addLogEntry(`${playerName} (Opp) - ${getStatLabel(statType)} removed`);
                renderOpponentStats();
                saveGameState();
            }
        }

        function updateOpponentNotes(playerId, notes) {
            gameState.opponentStats[playerId].notes = notes;
            saveGameState();
        }

        function logOpponentNote(playerId) {
            const player = opponentRoster.find(p => p.id === playerId);
            const playerName = player.name || 'Opponent Player';
            const notes = gameState.opponentStats[playerId].notes;
            if (notes.trim()) {
                addLogEntry(`${playerName} (Opp) - Note: ${notes}`);
            }
        }

        function renderOpponentStats() {
            const tbody = document.getElementById('opponentStatsTable');
            tbody.innerHTML = opponentRoster.map(player => {
                const stats = gameState.opponentStats[player.id];
                return `
                    <tr>
                        <td class="player-name">
                            <input type="text"
                                   value="${player.name}"
                                   onchange="updateOpponentName('${player.id}', this.value)"
                                   placeholder="Name..."
                                   style="width: 56px; border: 1px solid #d1d5db; border-radius: 2px; padding: 1px 2px; font-size: 9px; box-sizing: border-box;">
                        </td>
                        <td class="stat-cell-pts">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.pts || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementOpponentStat('${player.id}', 'pts')" ${stats.pts === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementOpponentStat('${player.id}', 'pts', 1)" title="+1">1</button>
                                    <button class="stat-btn increment" onclick="incrementOpponentStat('${player.id}', 'pts', 2)" title="+2">2</button>
                                    <button class="stat-btn increment" onclick="incrementOpponentStat('${player.id}', 'pts', 3)" title="+3">3</button>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.reb || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementOpponentStat('${player.id}', 'reb')" ${stats.reb === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementOpponentStat('${player.id}', 'reb')">+</button>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.ast || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementOpponentStat('${player.id}', 'ast')" ${stats.ast === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementOpponentStat('${player.id}', 'ast')">+</button>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.stl || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementOpponentStat('${player.id}', 'stl')" ${stats.stl === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementOpponentStat('${player.id}', 'stl')">+</button>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <div class="stat-controls">
                                <div class="stat-display">${stats.to || 0}</div>
                                <div class="stat-buttons">
                                    <button class="stat-btn decrement" onclick="decrementOpponentStat('${player.id}', 'to')" ${stats.to === 0 ? 'disabled' : ''}>-</button>
                                    <button class="stat-btn increment" onclick="incrementOpponentStat('${player.id}', 'to')">+</button>
                                </div>
                            </div>
                        </td>
                        <td class="notes-cell">
                            <div class="notes-container">
                                <input type="text" class="notes-input"
                                       value="${stats.notes}"
                                       onchange="updateOpponentNotes('${player.id}', this.value)"
                                       placeholder="Quick notes...">
                                <button class="notes-btn" onclick="logOpponentNote('${player.id}')">Log</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Email functionality
        function emailSummary() {
            const opponent = document.getElementById('opponentName').value || 'Unknown Opponent';
            const date = document.getElementById('gameDate').value || new Date().toLocaleDateString();
            const subject = `Wildcats Basketball Game Summary - ${opponent} - ${date}`;

            let body = `Wildcats Basketball Game Summary\n`;
            body += `Date: ${date}\n`;
            body += `Opponent: ${opponent}\n`;
            body += `Final Score: Wildcats ${gameState.homeScore} - ${gameState.awayScore} ${opponent}\n\n`;

            // Team totals
            let teamPts = 0, teamReb = 0, teamAst = 0, teamStl = 0, teamTo = 0;
            ROSTER.forEach(player => {
                const stats = gameState.stats[player.id];
                teamPts += stats.pts || 0;
                teamReb += stats.reb || 0;
                teamAst += stats.ast || 0;
                teamStl += stats.stl || 0;
                teamTo += stats.to || 0;
            });

            body += `WILDCATS TEAM TOTALS:\n`;
            body += `Points: ${teamPts}, Rebounds: ${teamReb}, Assists: ${teamAst}, Steals: ${teamStl}, Turnovers: ${teamTo}\n\n`;

            body += `WILDCATS PLAYER STATS:\n`;
            ROSTER.forEach(player => {
                const stats = gameState.stats[player.id];
                body += `#${player.jersey} ${player.name}: ${stats.pts || 0} PTS, ${stats.reb || 0} REB, ${stats.ast || 0} AST, ${stats.stl || 0} STL, ${stats.to || 0} TO`;
                if (stats.notes) body += ` - ${stats.notes}`;
                body += `\n`;
            });

            body += `\nOPPONENT TEAM STATS:\n`;
            opponentRoster.forEach(player => {
                const stats = gameState.opponentStats[player.id];
                const hasStats = stats.pts || stats.reb || stats.ast || stats.stl || stats.to || stats.notes;
                const playerName = player.name || 'Unnamed Player';

                if (hasStats || player.name) {
                    body += `${playerName}: ${stats.pts || 0} PTS, ${stats.reb || 0} REB, ${stats.ast || 0} AST, ${stats.stl || 0} STL, ${stats.to || 0} TO`;
                    if (stats.notes) body += ` - ${stats.notes}`;
                    body += `\n`;
                }
            });

            if (gameState.gameLog.length > 0) {
                body += `\nGAME LOG:\n`;
                gameState.gameLog.slice().reverse().forEach(entry => {
                    body += `${entry.time} - ${entry.text}\n`;
                });
            }

            // Create mailto link
            const mailto = `mailto:paul@paulsnider.net?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailto;
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startTimer);
        document.getElementById('stopBtn').addEventListener('click', stopTimer);
        document.getElementById('resetBtn').addEventListener('click', resetTimer);
        document.getElementById('emailBtn').addEventListener('click', emailSummary);
        document.getElementById('addOpponentBtn').addEventListener('click', addOpponentRow);

        // Save opponent and date
        document.getElementById('opponentName').addEventListener('change', function() {
            gameState.opponent = this.value;
            saveGameState();
        });

        document.getElementById('gameDate').addEventListener('change', function() {
            gameState.date = this.value;
            saveGameState();
        });

        // Initialize app
        function init() {
            loadGameState();
            renderStats();
            renderOpponentStats();
            renderGameLog();

            // Update timer every second
            setInterval(updateTimer, 1000);

            // Set today's date by default
            if (!gameState.date) {
                document.getElementById('gameDate').value = new Date().toISOString().split('T')[0];
            }
        }

        // Start the app
        init();

        // Warn user before leaving if game is active
        window.addEventListener('beforeunload', (event) => {
            const gameInProgress = gameState.isRunning || (gameState.gameLog && gameState.gameLog.length > 0);
            if (gameInProgress) {
                event.preventDefault();
                event.returnValue = 'Game activity is still in progress. Are you sure you want to leave?';
                return 'Game activity is still in progress. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
